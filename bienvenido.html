<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bookshop ‚Äî Bienvenida</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #111;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .frame{
      width:min(1100px, 100%);
      min-height:560px;
      border:3px solid #ffa60000;
      border-radius:12px;
      padding:26px;
      background: linear-gradient(74deg, #222, #111);
      padding: 205px 107px;
      box-shadow: 0 0 30px rgba(255, 165, 0, 0.2);
    }

    .header{ display:flex; align-items:center; gap:12px; padding:0 10px 30px 6px; }
    .brand{ font-weight:700; font-size:42px; color:#ffa500; text-shadow:1px 1px 4px #000; }

    .content{ display:grid; grid-template-columns: 380px 1fr; gap:30px; height:calc(100% - 68px); }

    .card{
      background: rgb(44 32 6 / 20%);
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(255, 165, 0, 0.2);
      padding:18px 20px 22px;
      border:5px solid rgba(255, 174, 0, 0.993);
    }
    .card h3{ margin:0 0 14px; font-size:28px; color:#ffa500; }

    .info-list{ list-style:none; margin:6px 0 0; padding:0; }
    .info-list li{ display:flex; flex-direction:column; margin-bottom:12px; }
    .info-list label{ font-size:14px; color:#ccc; margin-bottom:4px; font-weight:bold; }
    .info-list input{
      padding:12px;
      border-radius:10px;
      border:2px solid #ffa500;
      background-color:#e6950017;
      color:#fff;
      font-size:16px;
    }
    .info-list input:focus{ outline:2px solid #ffa500; }
    .info-list input:disabled{
      opacity:0.8;
      cursor:not-allowed;
      background-color:#3a3a3a17;
    }
    .info-list input[readonly]{
      opacity:0.9;
      cursor:default;
    }

    .panel{
      background: rgb(44 32 6 / 20%);
      border-radius: 10px;
      border:1px solid rgba(255,255,255,.06);
      box-shadow: 0 0 30px rgba(255, 165, 0, 0.2);
      padding:28px 30px 40px;
      position:relative;
      border: 5px solid #ffa500;
    }

    .welcome h1{ margin:0 0 6px; font-weight:600; font-size:50px; color:#ffa500; }
    .welcome h2{ margin:0; font-weight:300; font-size:22px; color:#ccc; }
    .date{ margin-top:18px; font-weight:700; color:#fff; }

    .actions{ position:absolute; right:30px; bottom:30px; }
    .btn{
      background-color: #ffa500;
      color:#000;
      padding:15px 30px;
      border-radius:5px;
      font-weight:700;
      border:none;
      cursor:pointer;
      transition: background-color 0.3s ease;
    }
    .btn:hover{ background-color:#e69500; }
  </style>
</head>
<body>
  <main class="frame">
    <div class="header">
      <div class="brand">Bookshop</div>
    </div>

    <section class="content">
      <aside class="card">
        <h3>Informaci√≥n</h3>
        <ul class="info-list">
          <li><label for="nombre">Nombre:</label><input type="text" id="nombre" disabled></li>
          <li><label for="apellidos">Apellidos:</label><input type="text" id="apellidos" disabled></li>
          <li><label for="telefono">Tel√©fono:</label><input type="text" id="telefono" disabled></li>
          <!--<li><label for="edad">Edad:</label><input type="number" id="edad"></li>-->
          <!--<li><label for="distrito">Distrito:</label><input type="text" id="distrito"></li>-->
          <!--<li><label for="dni">DNI:</label><input type="text" id="dni"></li>-->
          <li><label for="fechaRegistro">Fecha de Registro:</label><input type="text" id="fechaRegistro" disabled></li>
          <!--<li><label for="nivel">Nivel Acad.:</label><input type="text" id="nivel"></li>-->
          <!--<li><label for="direccion">Direcci√≥n:</label><input type="text" id="direccion"></li>-->
        </ul>
      </aside>

      <section class="panel">
        <div class="welcome">
          <h1>BIENVENIDO</h1>
          <h2 id="welcome-name">(NOMBRE DEL USUARIO)</h2>
          <div class="user-photo-container" style="margin-top: 20px; text-align: center;">
            <canvas id="user-photo" width="200" height="150" style="width: 260px; border: 3px solid #ffa500; border-radius: 12px; background: #222; box-shadow: 0 5px 15px rgba(255, 165, 0, 0.3);"></canvas>
            <p style="font-size: 14px; color: #ffa500; margin: 8px 0 0 0; text-align: center; font-weight: 600;">üì∏ Foto de Registro</p>
          </div>
        </div>
        <div class="actions">
          <a class="btn" id="btn-ingresar" href="informacion/ventas.html">Ingresar</a>
        </div>
      </section>
    </section>
  </main>

  <script>
    function formatDate(d){
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yy = String(d.getFullYear()).slice(-2);
      return `${dd}/${mm}/${yy}`;
    }

    // Funci√≥n para mostrar la foto del usuario desde los datos guardados
    function mostrarFotoUsuario(userData) {
      const canvas = document.getElementById('user-photo');
      const ctx = canvas.getContext('2d');

      // Limpiar canvas con fondo oscuro
      ctx.fillStyle = '#222';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      if (userData.fotoRegistro) {
        const img = new Image();
        img.onload = function() {
          try {
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Calcular dimensiones para mantener aspecto y centrar
            const imgAspect = img.width / img.height;
            const canvasAspect = canvas.width / canvas.height;

            let drawWidth, drawHeight, drawX, drawY;

            if (imgAspect > canvasAspect) {
              // La imagen es m√°s ancha, ajustar por altura
              drawHeight = canvas.height;
              drawWidth = drawHeight * imgAspect;
              drawX = (canvas.width - drawWidth) / 2;
              drawY = 0;
            } else {
              // La imagen es m√°s alta, ajustar por ancho
              drawWidth = canvas.width;
              drawHeight = drawWidth / imgAspect;
              drawX = 0;
              drawY = (canvas.height - drawHeight) / 2;
            }

            // Dibujar imagen centrada y escalada
            ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);

            // Agregar borde interno sutil
            ctx.strokeStyle = 'rgba(255, 165, 0, 0.3)';
            ctx.lineWidth = 2;
            ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);

          } catch (error) {
            console.error('Error al cargar imagen:', error);
            mostrarPlaceholder(ctx, canvas, 'Error al cargar foto');
          }
        };

        img.onerror = function() {
          console.error('Error al cargar imagen de registro');
          mostrarPlaceholder(ctx, canvas, 'Error al cargar foto');
        };

        img.src = userData.fotoRegistro;
      } else {
        // Si no hay foto, mostrar placeholder
        mostrarPlaceholder(ctx, canvas, 'Sin foto de registro');
      }
    }

    // Funci√≥n helper para mostrar placeholder
    function mostrarPlaceholder(ctx, canvas, mensaje) {
      ctx.fillStyle = '#333';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Icono de c√°mara
      ctx.fillStyle = '#666';
      ctx.font = '40px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('üì∑', canvas.width/2, canvas.height/2 - 20);

      // Texto del mensaje
      ctx.fillStyle = '#ffa500';
      ctx.font = '14px Arial';
      ctx.fillText(mensaje, canvas.width/2, canvas.height/2 + 15);

      // Borde
      ctx.strokeStyle = 'rgba(255, 165, 0, 0.3)';
      ctx.lineWidth = 2;
      ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);
    }

    // Cargar datos del usuario desde sessionStorage
    function cargarDatosUsuario() {
      const userData = sessionStorage.getItem('currentUser');

      if (!userData) {
        alert('No hay datos de usuario. Redirigiendo al login...');
        window.location.href = 'index.html';
        return;
      }

      try {
        const user = JSON.parse(userData);

        // Llenar los inputs con los datos del usuario
        document.getElementById('nombre').value = user.nombre || '';
        document.getElementById('apellidos').value = user.apellido || '';
        document.getElementById('telefono').value = user.telefono || '';

        // Mostrar fecha de registro si est√° disponible
        if (user.fechaRegistroFormateada) {
          document.getElementById('fechaRegistro').value = user.fechaRegistroFormateada;
        } else if (user.fechaRegistro) {
          // Formatear fecha de registro si solo tenemos ISO string
          const fechaReg = new Date(user.fechaRegistro);
          document.getElementById('fechaRegistro').value = fechaReg.toLocaleString('es-ES', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
        } else {
          document.getElementById('fechaRegistro').value = 'No disponible';
        }

        // Mostrar foto del usuario
        mostrarFotoUsuario(user);

        // Actualizar nombre de bienvenida
        const welcomeName = document.getElementById('welcome-name');
        const fullName = user.nombre && user.apellido
          ? `${user.nombre} ${user.apellido}`.toUpperCase()
          : (user.nombre || user.correo || '(USUARIO)').toUpperCase();
        welcomeName.textContent = fullName;

        console.log('Datos de usuario cargados:', user);

      } catch (error) {
        console.error('Error al cargar datos de usuario:', error);
        alert('Error al cargar datos de usuario');
        window.location.href = 'index.html';
      }
    }

    // Inicializar p√°gina
    document.addEventListener('DOMContentLoaded', () => {
      cargarDatosUsuario();
    });

    const nombreInput = document.getElementById('nombre');
    const welcomeName = document.getElementById('welcome-name');
    nombreInput.addEventListener('input', () => {
      const apellidoValue = document.getElementById('apellidos').value;
      const fullName = nombreInput.value && apellidoValue
        ? `${nombreInput.value} ${apellidoValue}`.toUpperCase()
        : (nombreInput.value || '(NOMBRE DEL USUARIO)').toUpperCase();
      welcomeName.textContent = fullName;
    });

    document.getElementById('apellidos').addEventListener('input', () => {
      const nombreValue = document.getElementById('nombre').value;
      const apellidoValue = document.getElementById('apellidos').value;
      const fullName = nombreValue && apellidoValue
        ? `${nombreValue} ${apellidoValue}`.toUpperCase()
        : (nombreValue || '(NOMBRE DEL USUARIO)').toUpperCase();
      welcomeName.textContent = fullName;
    });
  </script>
</body>
</html>
